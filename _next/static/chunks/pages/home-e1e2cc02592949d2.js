(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[229],{9621:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/home",function(){return n(8911)}])},8911:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var r=n(4195),o=n(6939),l=n.n(o),i=n(4762),a=n(292),c=n(5456);let s=(0,c.Ue)(e=>{var t,n;return{windowWidth:null===(t=window)||void 0===t?void 0:t.innerWidth,windowHeight:null===(n=window)||void 0===n?void 0:n.innerHeight,wBlockCount:0,hBlockCount:0,setWindowSize:()=>e(()=>({windowWidth:window.innerWidth,windowHeight:window.innerHeight})),setWBlockCount:t=>e({wBlockCount:t}),setHBlockCount:t=>e({hBlockCount:t})}});var u=n(2699);let d=(0,c.Ue)((e,t)=>({updateTime:0,data:(()=>{if("undefined"==typeof localStorage)return{};let e=localStorage.getItem("pluginData");return e?JSON.parse(e):{}})(),readPluginConfig:()=>{fetch("./data/plugins.json").then(e=>e.json()).then(n=>{e((0,u.merge)(t(),n,{updateTime:new Date().getTime()}))})},setEnabled:(t,n)=>e(e=>({data:{...e.data,[t]:{...e.data[t],enabled:n}}})),updateConfig:t=>e(e=>{let n={...e.data,...t};return localStorage.setItem("pluginData",JSON.stringify(n)),{data:n}}),updatePluginConfig:(t,n)=>e(e=>{let r={...e.data,[t]:n};return localStorage.setItem("pluginData",JSON.stringify(r)),{data:r}})}));function f(e){var t;let n;let{cardInf:o,netRef:l,boardInfo:c}=e,[s,u]=(0,i.useState)(),f=(0,a.W)(),h=d(),{uiConfig:g,editing:p,registerI18n:m,updateCardPosition:x,t:w}=f,{data:v,updateTime:b}=h;(0,i.useEffect)(()=>(o.i18n&&m(o.i18n),o.register.install(v,u,f,h),o.register.render(g,w),console.log("Card ".concat(o.name," loaded.")),o.register.uninstall),[v,b,g,w]),(0,i.useEffect)(()=>{o.register.render(g,w)},[g.language]);let j=e=>{let t=Math.max(Math.round(e.clientX/g.blockSize),0),n=Math.max(Math.round(e.clientY/g.blockSize),0),r=o.position[g.rotation];t>=c.wBlockCount-r.w-1&&(t=c.wBlockCount-r.w),n>=c.hBlockCount-r.h-1&&(n=c.hBlockCount-r.h),x(o.name,g.rotation,{...r,x:t,y:n})},y=(n=null,function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n||(n=setTimeout(()=>{j.apply(this,t),n=null},100))}),k=e=>{p&&y(e)};if(null==l.current)return console.info("cannot find board ref, ignored"),(0,r.jsx)("div",{className:"error-card"});let C=o.position[g.rotation],N=C.x>-1?C.x:c.wBlockCount+C.x,S=C.y>-1?C.y:c.hBlockCount+C.y,B=l.current.querySelector("#net-".concat(N,"-").concat(S));if(null==B)return console.info("cannot find target start block, ignored"),(0,r.jsx)("div",{className:"error-card"});let E=B.getBoundingClientRect(),O=C.w>0?Math.min(N+C.w-1,c.wBlockCount-1):c.wBlockCount+C.w-1,_=C.h>0?Math.min(S+C.h-1,c.hBlockCount-1):c.hBlockCount+C.h-1,W=l.current.querySelector("#net-".concat(O,"-").concat(_));if(null==W)return console.info("cannot find target end block, ignored"),(0,r.jsx)("div",{className:"error-card"});let T=W.getBoundingClientRect(),z="card-".concat(o.name," card absolute ").concat((null===(t=o.style)||void 0===t?void 0:t.extraClass)||"");return(0,r.jsx)("div",{className:z,onDrag:k,style:{left:"".concat(null==E?void 0:E.left,"px"),top:"".concat(null==E?void 0:E.top,"px"),width:"".concat((null==T?void 0:T.right)-(null==E?void 0:E.left),"px"),height:"".concat((null==T?void 0:T.bottom)-(null==E?void 0:E.top),"px")},children:s})}var h=n(2187),g=n.n(h);let p={tab:{"h-12":!0,"cursor-pointer":!0},activeTab:{"h-12":!0,"cursor-pointer":!0,underline:!0,"underline-offset-2":!0}};var m=function(){let e=(0,a.W)(),t=d(),[n,o]=(0,i.useState)(0),l=function(n,r){"main"===r?e.setUIConfig(n):t.updatePluginConfig(r,n)},c=function(t,n){let o=Object.keys(t),i="flex flex-row p-2 items-center",a="bg-slate-700/80 rounded-md p-1 w-60",c=[];for(let s=0;s<o.length;++s){let u=o[s];switch(typeof t[u]){case"number":case"string":c.push((0,r.jsxs)("div",{className:i,children:[(0,r.jsxs)("label",{htmlFor:u,className:"px-2 w-44",children:[e.t(u),": "]}),(0,r.jsx)("input",{type:"text",name:u,value:t[u],className:a,onChange:e=>{t[u]=e.target.value,l(t,n)}})]},u));break;case"object":Object.keys(t[u]).forEach(o=>{let s="".concat(u,".").concat(o);c.push((0,r.jsxs)("div",{className:i,children:[(0,r.jsxs)("label",{htmlFor:s,className:"px-2 w-44",children:[e.t(s),": "]}),(0,r.jsx)("input",{type:"text",name:s,value:t[u][o],className:a,onChange:e=>{t[u][o]=e.target.value,l(t,n)}})]},s))})}}return c},s=["main",...Object.keys(t.data||{})],u=[];return s.forEach((n,r)=>{0===r?u.push(c(e.uiConfig,"main")):u.push(c(t.data[n],0===r?"main":n))}),(0,r.jsxs)("div",{className:"absolute z-10 w-10/12 h-5/6 rounded-xl bg-stone-700/70 flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"flex flex-row items-center",children:[(0,r.jsx)("div",{className:"flex flex-col setting-tab flex-shrink-0 p-4",children:s.map((t,l)=>{let i=l===n?p.activeTab:p.tab;return(0,r.jsx)("div",{className:g()(i),onClick:()=>o(l),children:e.t(t)},t)})}),(0,r.jsx)("div",{className:"",children:u[n]})]}),(0,r.jsx)("div",{className:"flex flex-row items-center mt-4",children:(0,r.jsx)("div",{className:"px-6 py-2 bg-black/50 rounded-xl",onClick:()=>{e.setCurrentPage("home"),e.saveConfig()},children:"O K"})})]})};function x(){let{hBlockCount:e,wBlockCount:t,setHBlockCount:n,setWBlockCount:o}=s(),{currentPage:c,readConfig:u,setRotation:h}=(0,a.W)(),[g,p]=(0,i.useState)([]),x=(0,i.useRef)(null),{data:w,readPluginConfig:v,updateConfig:b}=d();(0,i.useEffect)(()=>{u(),v();let e=()=>{let e=window.innerWidth-2*y.padding,t=window.innerHeight-2*y.padding;o(Math.floor(e/y.blockSize)),n(Math.floor(t/y.blockSize)),h(e>t?"landscape":"portrait")};return e(),window.addEventListener("resize",e),w&&0!==Object.keys(w).length||fetch("./data/plugins.json").then(e=>e.json()).then(e=>b(e)),()=>{window.removeEventListener("resize",e)}},[]);let{cardInfos:j,uiConfig:y,initialized:k}=(0,a.W)();return(0,i.useEffect)(()=>{let n=[];for(let o=0;o<e;++o)for(let e=0;e<t;++e)n.push((0,r.jsx)("div",{id:"net-".concat(e,"-").concat(o)},o*t+e));p(n)},[e,t]),(0,r.jsxs)("main",{className:"flex min-h-screen h-full w-full p-24 bg-cover items-center justify-center relative",id:"main",style:{backgroundImage:"url(./".concat(y.bg,")")},children:[(0,r.jsxs)(l(),{children:[(0,r.jsx)("title",{children:"Summer Shadow"}),(0,r.jsx)("link",{href:"/dist/styles.css",rel:"stylesheet"})]}),(0,r.jsxs)("div",{className:"w-full h-full flex items-center justify-center absolute",style:{padding:"".concat(y.padding,"px")},children:[(0,r.jsx)("div",{id:"main-board",className:"grid w-full h-full [&>div]:border [&>div]:border-slate-400/60",ref:x,style:{gridTemplateColumns:"repeat(".concat(t,", 1fr)"),gridTemplateRows:"repeat(".concat(e,", 1fr)")},children:g}),"setting"===c&&(0,r.jsx)(m,{}),Object.keys(j).map(n=>(0,r.jsx)(f,{cardInf:j[n],netRef:x,boardInfo:{wBlockCount:t,hBlockCount:e}},n))]})]})}n(1637)},6939:function(e,t,n){e.exports=n(376)},2187:function(e,t){var n;/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/!function(){"use strict";var r={}.hasOwnProperty;function o(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=l(e,function(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return o.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=l(t,n));return t}(n)))}return e}function l(e,t){return t?e?e+" "+t:e+t:e}e.exports?(o.default=o,e.exports=o):void 0!==(n=(function(){return o}).apply(t,[]))&&(e.exports=n)}()}},function(e){e.O(0,[84,548,201,68,716,888,179],function(){return e(e.s=9621)}),_N_E=e.O()}]);